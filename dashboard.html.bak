<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OpsMind Dashboard - IT Service Management">
    <title>Dashboard - OpsMind</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/assets/css/main.css" rel="stylesheet">

    <!-- Runtime config (must be before any app/service scripts) -->
    <script src="/assets/js/config.js"></script>
</head>
<body class="app-body">
    <!-- Navigation (loaded dynamically) -->
    <nav class="navbar-main" id="navbar-container"></nav>

    <div class="app-wrapper">
        <!-- Sidebar (loaded dynamically) -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome back! Here's your IT operations overview.</p>
                </div>
                <div class="page-header-actions">
                    <button class="btn btn-outline-secondary" id="refreshDashboard">
                        <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div class="page-content">
                <!-- Stats Cards Row -->
                <div class="row g-4 mb-4">
                    <!-- Open Tickets Card -->
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="stat-card stat-card-primary">
                            <div class="stat-card-body">
                                <div class="stat-icon">
                                    <i class="bi bi-ticket-detailed"></i>
                                </div>
                                <div class="stat-info">
                                    <p class="stat-label">Open Tickets</p>
                                    <h3 class="stat-value" id="openTicketsCount">
                                        <span class="placeholder-glow">
                                            <span class="placeholder col-4"></span>
                                        </span>
                                    </h3>
                                    <p class="stat-change positive">
                                        <i class="bi bi-arrow-down-short"></i>
                                        <span id="openTicketsChange">--</span> from last week
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- In Progress Card -->
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="stat-card stat-card-info">
                            <div class="stat-card-body">
                                <div class="stat-icon">
                                    <i class="bi bi-hourglass-split"></i>
                                </div>
                                <div class="stat-info">
                                    <p class="stat-label">In Progress</p>
                                    <h3 class="stat-value" id="inProgressCount">
                                        <span class="placeholder-glow">
                                            <span class="placeholder col-4"></span>
                                        </span>
                                    </h3>
                                    <p class="stat-change neutral">
                                        <i class="bi bi-dash"></i>
                                        <span id="inProgressChange">--</span> from last week
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SLA Violations Card -->
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="stat-card stat-card-danger">
                            <div class="stat-card-body">
                                <div class="stat-icon">
                                    <i class="bi bi-exclamation-triangle"></i>
                                </div>
                                <div class="stat-info">
                                    <p class="stat-label">SLA Violations</p>
                                    <h3 class="stat-value" id="slaViolationsCount">
                                        <span class="placeholder-glow">
                                            <span class="placeholder col-4"></span>
                                        </span>
                                    </h3>
                                    <p class="stat-change negative">
                                        <i class="bi bi-arrow-up-short"></i>
                                        <span id="slaViolationsChange">--</span> from last week
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Recommendations Card -->
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="stat-card stat-card-success">
                            <div class="stat-card-body">
                                <div class="stat-icon">
                                    <i class="bi bi-robot"></i>
                                </div>
                                <div class="stat-info">
                                    <p class="stat-label">AI Recommendations</p>
                                    <h3 class="stat-value" id="aiRecommendationsCount">
                                        <span class="placeholder-glow">
                                            <span class="placeholder col-4"></span>
                                        </span>
                                    </h3>
                                    <p class="stat-change positive">
                                        <span id="aiRecommendationsChange">--</span> pending review
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Activity Row -->
                <div class="row g-4 mb-4">
                    <!-- Ticket Trend Chart -->
                    <div class="col-12 col-lg-8">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="bi bi-graph-up me-2"></i>Ticket Trends
                                </h5>
                                <div class="card-header-actions">
                                    <select class="form-select form-select-sm" id="chartPeriod">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="ticketTrendChart">
                                    <!-- Simple CSS chart bars -->
                                    <div class="simple-bar-chart" id="barChart">
                                        <div class="chart-loading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-legend">
                                        <span class="legend-item">
                                            <span class="legend-color bg-primary"></span> Created
                                        </span>
                                        <span class="legend-item">
                                            <span class="legend-color bg-success"></span> Resolved
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="col-12 col-lg-4">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="bi bi-activity me-2"></i>Recent Activity
                                </h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="activity-list" id="recentActivity">
                                    <!-- Activity loading skeleton -->
                                    <div class="activity-loading">
                                        <div class="activity-item placeholder-glow">
                                            <span class="placeholder col-8"></span>
                                            <span class="placeholder col-4"></span>
                                        </div>
                                        <div class="activity-item placeholder-glow">
                                            <span class="placeholder col-6"></span>
                                            <span class="placeholder col-5"></span>
                                        </div>
                                        <div class="activity-item placeholder-glow">
                                            <span class="placeholder col-7"></span>
                                            <span class="placeholder col-4"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <a href="tickets.html" class="btn btn-link btn-sm p-0">
                                    View all activity <i class="bi bi-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Priority Tickets and Workflows Row -->
                <div class="row g-4">
                    <!-- High Priority Tickets -->
                    <div class="col-12 col-lg-6">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="bi bi-fire me-2 text-danger"></i>High Priority Tickets
                                </h5>
                                <a href="tickets.html?priority=high" class="btn btn-sm btn-outline-primary">View All</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Subject</th>
                                                <th>Status</th>
                                                <th>Age</th>
                                            </tr>
                                        </thead>
                                        <tbody id="priorityTicketsTable">
                                            <!-- Loading skeleton -->
                                            <tr class="placeholder-glow">
                                                <td><span class="placeholder col-8"></span></td>
                                                <td><span class="placeholder col-12"></span></td>
                                                <td><span class="placeholder col-6"></span></td>
                                                <td><span class="placeholder col-4"></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Empty State (hidden by default) -->
                                <div class="empty-state d-none" id="priorityTicketsEmpty">
                                    <i class="bi bi-check-circle"></i>
                                    <p>No high priority tickets</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Workflows -->
                    <div class="col-12 col-lg-6">
                        <div class="card dashboard-card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="bi bi-diagram-3 me-2 text-primary"></i>Active Workflows
                                </h5>
                                <a href="workflows.html" class="btn btn-sm btn-outline-primary">View All</a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Workflow</th>
                                                <th>Trigger</th>
                                                <th>Status</th>
                                                <th>Progress</th>
                                            </tr>
                                        </thead>
                                        <tbody id="activeWorkflowsTable">
                                            <!-- Loading skeleton -->
                                            <tr class="placeholder-glow">
                                                <td><span class="placeholder col-10"></span></td>
                                                <td><span class="placeholder col-8"></span></td>
                                                <td><span class="placeholder col-6"></span></td>
                                                <td><span class="placeholder col-12"></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Empty State (hidden by default) -->
                                <div class="empty-state d-none" id="activeWorkflowsEmpty">
                                    <i class="bi bi-diagram-3"></i>
                                    <p>No active workflows</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Container (for dynamic modals) -->
    <div id="modal-container"></div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sidebar Toggle (inline for immediate functionality) -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var toggle = document.getElementById('sidebarToggle');
            var sidebar = document.getElementById('sidebar-container');
            var backdrop = document.getElementById('sidebarBackdrop');
            
            if (toggle && sidebar) {
                toggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                    if (backdrop) backdrop.classList.toggle('show');
                });
            }
            if (backdrop) {
                backdrop.addEventListener('click', function() {
                    sidebar.classList.remove('show');
                    backdrop.classList.remove('show');
                });
            }
        });
    </script>
    <!-- Mock API (for demo mode - load before other scripts) -->
    <script src="/assets/js/mock-api.js"></script>
    <!-- App Module -->
    <script type="module" src="/assets/js/app.js"></script>
    <!-- Dashboard specific script -->
    <script type="module">
        import { initDashboard } from '/assets/js/pages/dashboard.js';
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
